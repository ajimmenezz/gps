(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24aeb3b6"],{"0dcd":function(t,e,a){},"3d92":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:" row "},[t._m(0),a("div",{staticClass:" col-12"},[a("div",{staticClass:"card"},[t._m(1),a("div",{staticClass:"card-body float-left"},[a("div",{staticClass:"row"},[t._m(2),a("hr"),a("div",{staticClass:"col-12 col-md-4"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"exampleFormControlSelect1"}},[t._v("Dispositivo")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.device,expression:"device"}],staticClass:"form-control",attrs:{id:"exampleFormControlSelect1"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.device=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"0"}},[t._v("Selecciona dispositivo")]),t._l(t.listDevice,(function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.alias))])}))],2)])]),a("div",{staticClass:"col-6 col-md-4"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"exampleFormControlSelect1"}},[t._v("Geeocerca")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.geocerca,expression:"geocerca"}],staticClass:"form-control",attrs:{id:"exampleFormControlSelect1"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.geocerca=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"0",disabled:""}},[t._v("Selecciona")]),a("option",{attrs:{value:"0"}},[t._v("Todas las geocercas")]),t._l(t.listGeofences,(function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}))],2)])]),a("div",{staticClass:"col-6 col-md-4"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"exampleFormControlSelect1"}},[t._v("Comportamiento")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.comport,expression:"comport"}],staticClass:"form-control",attrs:{id:"exampleFormControlSelect1"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.comport=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"0",disabled:""}},[t._v("Selecciona")]),a("option",{attrs:{value:"1"}},[t._v("Entradas")]),a("option",{attrs:{value:"2"}},[t._v("Salidas")]),a("option",{attrs:{value:"3"}},[t._v("Entradas/Salidas")])])])]),a("div",{staticClass:"col-12 col-md-6"},[a("config-text-typography",{attrs:{texto:"Fecha de inicio"}}),a("input",{staticClass:"form-control",attrs:{type:"text",id:"date-start1",placeholder:"Fecha de inicio"}})],1),a("div",{staticClass:"col-12 col-md-6"},[a("config-text-typography",{attrs:{texto:"Fecha final"}}),a("input",{staticClass:"form-control",attrs:{type:"text",id:"date-end1",placeholder:"Fecha final"}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-6 float-left",staticStyle:{"margin-top":"30px"}},[a("button",{staticClass:"btn btn-secondary ",on:{click:function(e){return t.cancel()}}},[t._v("CANCELAR")])]),a("div",{staticClass:"col-6 float-right",staticStyle:{"margin-top":"30px"}},[a("button",{staticClass:"btn btn-primary ",on:{click:function(e){return t.createReport()}}},[t._v("GENERAR")])])]),null==t.ShowLoader||t.ShowLoader?t._e():a("div",{attrs:{id:"loader"}}),t._m(3),t.showResultado&&this.reports.length>0?a("div",{staticClass:"row",staticStyle:{"margin-top":"20px"}},[t._m(4),a("hr"),a("div",{staticClass:"col-12 text-left",staticStyle:{"margin-bottom":"10px"}},[a("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button"},on:{click:function(e){return t.first()}}},[t._v("Primero")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.prev()}}},[t._v("Anterior")]),a("span",{staticStyle:{"padding-top":"1em","margin-left":"15px","margin-right":"15px"}},[a("b",[t._v("Pagina "+t._s(t.pageNo)+" de "+t._s(t.pages))])]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.next()}}},[t._v("Siguiente")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.last()}}},[t._v("Ultimo")]),a("json-csv",{staticClass:"float-right",attrs:{data:t.reports,fields:t.csvFields,labels:t.csvLabels,name:t.csvFileName}},[a("span",{staticClass:"cssToolTip cursor"},[a("i",{staticClass:"icon universalicon-file-csv",staticStyle:{"font-size":"30px"}}),a("span",{staticStyle:{top:"13px!important",left:"-180%!important"}},[t._v("Exportar csv")])])])],1),a("div",{staticClass:"table-responsive scrollTable"},[a("table",{staticClass:"table table-hover header_fijo"},[t._m(5),a("tbody",t._l(t.reportsTable,(function(e,i){return a("tr",{key:i},[a("td",[t._v(t._s(t._f("moment")(1e3*e.timestamp,"DD-MMM-YYYY HH:mm:ss")))]),a("td",[t._v(t._s(e.deviceAlias))]),a("td",[t._v(t._s(e.behaviorString))]),a("td",[t._v(t._s(e.geofenceTypeString))]),a("td",[t._v(t._s(e.geofenceName))]),a("td",[t._v(t._s(e.lat)+","+t._s(e.lng))]),a("td",[t._v(t._s(e.address))])])})),0)])]),a("div",{staticClass:"col-12 text-left",staticStyle:{"margin-top":"15px"}},[a("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button"},on:{click:function(e){return t.first()}}},[t._v("Primero")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.prev()}}},[t._v("Anterior")]),a("span",{staticStyle:{"padding-top":"1em","margin-left":"15px","margin-right":"15px"}},[a("b",[t._v("Pagina "+t._s(t.pageNo)+" de "+t._s(t.pages))])]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.next()}}},[t._v("Siguiente")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.last()}}},[t._v("Ultimo")])])]):t._e(),t.showResultado&&this.reports.length<=0?a("div",{staticClass:"row",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"col-12"},[t._v("No se obtuvieron resultados")])]):t._e()])])])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-12"},[a("h5",{staticClass:"float-left",staticStyle:{"font-size":"20px","padding-bottom":"10px"}},[a("b",[t._v("Reportes - Reporte geocercas")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-header row"},[a("div",{staticClass:"col-6"},[a("h5",{staticClass:" float-left"},[t._v("Reporte geocercas")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-12 "},[a("h5",[t._v("Generar reporte")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"col-12",attrs:{id:"alertReport"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-8 "},[a("h5",[t._v("Reporte")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",[t._v("Fecha")]),a("th",[t._v("Dispositivo")]),a("th",[t._v("Evento")]),a("th",[t._v("Tipo geocerca")]),a("th",[t._v("Geocerca")]),a("th",[t._v("Ubicacion")]),a("th",[t._v("Direccion")])])])}],r=(a("96cf"),a("3b8d")),o=(a("ac6a"),a("8615"),a("2347")),n=a.n(o),c=a("08e6"),l=a("d3e3"),p=a("511d"),u={name:"reporteGeocercas",mixins:[c["a"],p["a"]],components:{JsonCsv:n.a},data:function(){return{comport:0,geocerca:0,device:0,resultado:!1,listDevice:[],listGeofences:[],ShowLoader:null,reports:[],csvFields:["fechaString","deviceImeiString","deviceAlias","behaviorString","geofenceTypeString","geofenceName","lat","lng","address"],csvLabels:{fechaString:"FECHA",deviceImeiString:"IMEI",deviceAlias:"DISPOSITIVO",behaviorString:"EVENTO",geofenceTypeString:"TIPO GEOCERCA",geofenceName:"NOMBRE GEOCERCA",lat:"LATITUD",lng:"LONGITUD",address:"DIRECCION"},csvFileName:"",reportsTable:[],pageNo:1,pageSize:100,pageCount:0,pages:0,fechaInicio:"",fechaFinal:""}},created:function(){this.$store.state.loader=!1,this.listDevice=Object.values(this.$store.state.devices.devices),this.getlistGeofence()},mounted:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.$store.state.seccionMenu="reportes",t.next=3,l["a"].$emit("NAVBAR_MenuSimple","reportes");case 3:$("#containerPrincipal").css({"margin-left":this.$store.state.widthMenu}),$("#containerPrincipal").css({"margin-top":this.$store.state.topMenu}),e=new Date,a=e.getDate(),i=e.getMonth(),s=e.getFullYear(),$("#date-end1").bootstrapMaterialDatePicker({weekStart:0,lang:"es",format:"MMMM DD, YYYY HH:mm:ss",shortTime:!0,year:!0,date:!0,time:!1,maxDate:this.$moment(new Date).endOf("day"),minDate:this.$moment(new Date).startOf("day")}),$("#date-start1").bootstrapMaterialDatePicker({weekStart:0,lang:"es",format:"MMMM DD, YYYY HH:mm:ss",currentDate:this.$moment(new Date).startOf("day"),maxDate:this.$moment(new Date).endOf("day"),shortTime:!0,year:!0,date:!0,time:!1}).on("change",(function(t,r){var o=new Date(r);this.fechaInicio=r;var n=o.getFullYear(),c=o.getDate();console.debug("fech sin formato",o);var l=o.getMonth(),p=o.setMonth(l+3),u=o.getMonth(),d=o.getFullYear();console.debug(e,"actual",l,n),console.debug(o,"fecha mas3",u,d,"nueva fecha",p),d>s?(console.debug("año diferente",a,c),o=new Date):d==s&&(console.debug("mismo año"),u>l&&(o=new Date),u==i&&c>a&&(console.debug("dia mayor, mismo mes"),o=new Date)),console.debug("fecha FINAL",o),$("#date-end1").bootstrapMaterialDatePicker("setMinDate",r),$("#date-end1").bootstrapMaterialDatePicker("setMaxDate",o)})).on("change",(function(t,e){this.fechaFinal=e,console.debug("FECHA_FIANL",this.fechaFinal)})),this.$store.state.loader=!1;case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:{getlistGeofence:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e={geofenceType:1},t.next=3,this.getRequest("geofences",e);case 3:a=t.sent,!0===a.success?this.listGeofences=a.data.geofences:console.log("fail");case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),cancel:function(){this.$router.push("/reports")},createReport:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,i,s,r,o,n,c,l=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!=this.device&&"0"!=this.device){t.next=4;break}return $("#alertReport").html("<div class='alert alert-danger alert-dismissible fade show' role='alert' style='text-align: initial;'><strong>Error! </strong>Debe seleccionar un dispositivo<button type='button' class='close' data-dismiss='alert' aria-label='Close' style='padding-top: 0px;'><span aria-hidden='true'>&times;</span></button></div>"),setTimeout((function(){$("#alertReport").html("")}),3e3),t.abrupt("return",0);case 4:if(e={deviceID:parseInt(this.device)},0!=this.comport&&3!=this.comport&&(e.behavior=this.comport),0!=this.geocerca&&"0"!=this.geocerca&&(e.geofenceID=this.geocerca),a=$("#date-start1").val(),i=$("#date-end1").val(),s=this.fechaEsp(a),r=this.fechaEsp(i),console.debug(s,"DATOS_FECHA",r),""!=s||""!=r){t.next=15;break}t.next=25;break;case 15:if(""==s||""==r){t.next=22;break}o=Date.parse(s)/1e3,n=Date.parse(r)/1e3,e.fromTimestamp=o,e.tillTimestamp=n,t.next=25;break;case 22:return $("#alertReport").html("<div class='alert alert-danger alert-dismissible fade show' role='alert' style='text-align: initial;'><strong>Error! </strong>Debe ingresar las 2 fechas<button type='button' class='close' data-dismiss='alert' aria-label='Close' style='padding-top: 0px;'><span aria-hidden='true'>&times;</span></button></div>"),setTimeout((function(){$("#alertReport").html("")}),3e3),t.abrupt("return",0);case 25:this.listDevice.forEach((function(t){t.id==l.device&&(l.deviceImei=t.imei,l.deviceAlias=t.alias)})),this.ShowLoader=!0,this.$store.state.loader=!0,this.reports=[],c="ReporteGeocercas",parseInt(this.deviceImei),"190807",this.csvFileName="".concat(c,".csv"),console.debug("FILTRO",e),this.getReports(e);case 35:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getReports:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var a,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getRequest("reports/geofences",e);case 2:a=t.sent,a.data.reports.forEach((function(t){try{var e=i.$moment.unix(parseInt(t.timestamp));t.deviceImeiString="'"+t.deviceImei,t.fechaString=e.format("DD-MMM-YYYY HH:mm:ss"),"GEOFENCE"==t.geofenceTypeString?t.geofenceTypeString="GEOCERCA":"POINT_OF_INTEREST"==t.geofenceTypeString&&(t.geofenceTypeString="PUNTO DE INTERES"),"IN"==t.behaviorString?t.behaviorString="ENTRANDO":"OUT"==t.behaviorString&&(t.behaviorString="SALIENDO")}catch(a){console.warn("Error parsing timestamp"),t.fechaString=e.format("No disponible")}})),this.reports=this.reports.concat(a.data.reports),a.pagination.next?(console.debug("Next"),e={paginationToken:a.pagination.next},this.getReports(e)):(console.debug("FINISH"),this.init(),this.ShowLoader=!1,this.$store.state.loader=!1,this.resultado=!0);case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),init:function(){this.pages=this.count({}),this.pages=Math.ceil(this.pages/this.pageSize),this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize})},page:function(t){this.virtualService({pageNo:t,pageSize:this.pageSize})},first:function(){this.pageNo=1,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize})},last:function(){this.pageNo=this.pageCount,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize})},prev:function(){this.pageNo>1&&(this.pageNo-=1,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize}))},next:function(){console.debug("".concat(this.pageNo," < ").concat(this.pageCount)),this.pageNo<this.pageCount&&(this.pageNo+=1,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize}))},count:function(t){return this.reports.length},queryFromVirtualDB:function(t,e,a){var i=[];t={};this.count(t);return console.debug("GET REPORTS FROM ".concat(e," AT ").concat(a),t),i=this.reports.slice(e,a),i},virtualService:function(t){var e={},a=t.pageNo,i=t.pageSize,s=Math.ceil(this.count(e)/i);0==a&&(a=1),a<0?a=s:a>s&&(a=s);var r=(a-1)*i+1,o=r+i-1,n=this.queryFromVirtualDB(e,r,o);this.reportsTable=n,this.pageNo=a,this.pageCount=s}},computed:{showResultado:function(){return this.resultado}}},d=u,v=(a("f258"),a("2877")),h=Object(v["a"])(d,i,s,!1,null,null,null);e["default"]=h.exports},f258:function(t,e,a){"use strict";var i=a("0dcd"),s=a.n(i);s.a}}]);
//# sourceMappingURL=chunk-24aeb3b6.5b3487ad.js.map