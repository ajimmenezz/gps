(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ee17524c"],{"0c77":function(e,t,a){},"0f50":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:" row "},[e._m(0),a("div",{staticClass:" col-12"},[a("div",{staticClass:"card"},[e._m(1),a("div",{staticClass:"card-body float-left"},[a("div",{staticClass:"row"},[e._m(2),a("hr"),a("div",{staticClass:"col-12 col-md-6"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"exampleFormControlSelect1"}},[e._v("Dispositivo")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.device,expression:"device"}],staticClass:"form-control",attrs:{id:"exampleFormControlSelect1"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.device=t.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"0"}},[e._v("Selecciona dispositivo")]),e._l(e.listDEvice,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.alias))])}))],2)])]),a("div",{staticClass:"col-12 col-md-3"},[a("config-text-typography",{attrs:{texto:"Fecha de inicio"}}),a("input",{staticClass:"form-control",attrs:{type:"text",id:"date-start1",placeholder:"Fecha de inicio"}})],1),a("div",{staticClass:"col-12 col-md-3"},[a("config-text-typography",{attrs:{texto:"Fecha final"}}),a("input",{staticClass:"form-control",attrs:{type:"text",id:"date-end1",placeholder:"Fecha final"}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-6 float-left",staticStyle:{"margin-top":"30px"}},[a("button",{staticClass:"btn btn-secondary ",on:{click:function(t){return e.cancel()}}},[e._v("CANCELAR")])]),a("div",{staticClass:"col-6 float-right",staticStyle:{"margin-top":"30px"}},[a("button",{staticClass:"btn btn-primary ",on:{click:function(t){return e.createReport()}}},[e._v("GENERAR")])])]),null==e.ShowLoader||e.ShowLoader?e._e():a("div",{attrs:{id:"loader"}}),e._m(3),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showResultado&&this.reports.length>0,expression:"showResultado && this.reports.length>0"}],staticClass:"row",staticStyle:{"margin-top":"20px"}},[e._m(4),a("div",{directives:[{name:"show",rawName:"v-show",value:e.map.show,expression:"map.show"}],staticClass:"col-12",style:{height:e.map.height+"px"},attrs:{id:"map-container"}},[a("google-maps",{ref:"map",staticStyle:{width:"100% !important"},attrs:{name:"map",lat:e.map.position.lat,lng:e.map.position.lng,zoom:5,height:e.map.height,zoomControl:!0,streetViewControl:!1,markerSize:"38"},on:{onMapReady:e.OnMapReady}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.map.show,expression:"!map.show"}],staticClass:"col-12 text-center"},[a("div",{staticClass:"alert-dark"},[e._v("Seleccione un registro para mostrar su ubicacion en el mapa")])])]),e.showResultado&&this.reports.length>0?a("div",{staticClass:"row",staticStyle:{"margin-top":"40px"}},[e._m(5),a("hr"),a("div",{staticClass:"col-12 text-left",staticStyle:{"margin-bottom":"10px"}},[a("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button"},on:{click:function(t){return e.first()}}},[e._v("Primero")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.prev()}}},[e._v("Anterior")]),a("span",{staticStyle:{"padding-top":"1em","margin-left":"15px","margin-right":"15px"}},[a("b",[e._v("Pagina "+e._s(e.pageNo)+" de "+e._s(e.pages))])]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.next()}}},[e._v("Siguiente")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.last()}}},[e._v("Ultimo")]),a("json-csv",{staticClass:"float-right",attrs:{data:e.reports,fields:e.csvFields,labels:e.csvLabels,name:e.csvFileName}},[a("span",{staticClass:"cssToolTip cursor"},[a("i",{staticClass:"icon universalicon-file-csv",staticStyle:{"font-size":"30px"}}),a("span",{staticStyle:{top:"13px!important",left:"-180%!important"}},[e._v("Exportar csv")])])])],1),a("div",{staticClass:"table-responsive scrollTable"},[a("table",{staticClass:"table table-hover header_fijo"},[e._m(6),a("tbody",e._l(e.reportsTable,(function(t,s){return a("tr",{key:s},[a("td",[e._v(e._s(e._f("moment")(1e3*t.timestamp,"DD-MMM-YYYY HH:mm:ss")))]),a("td",[e._v(e._s(t.alias))]),a("td",[e._v(e._s(t.reportTypeString))]),a("td",[a("span",{staticClass:"text-primary cursor-pointer",on:{click:function(a){return e.ShowReportOnMap(t)}}},[e._v("\n                                          "+e._s(t.lat)+","+e._s(t.lng)+"\n                                        ")])]),a("td",[e._v(e._s(t.address))]),a("td",[e._v(e._s(t.speed))])])})),0)])]),a("div",{staticClass:"col-12 text-left",staticStyle:{"margin-top":"15px"}},[a("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button"},on:{click:function(t){return e.first()}}},[e._v("Primero")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.prev()}}},[e._v("Anterior")]),a("span",{staticStyle:{"padding-top":"1em","margin-left":"15px","margin-right":"15px"}},[a("b",[e._v("Pagina "+e._s(e.pageNo)+" de "+e._s(e.pages))])]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.next()}}},[e._v("Siguiente")]),a("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.last()}}},[e._v("Ultimo")])])]):e._e(),e.showResultado&&this.reports.length<=0?a("div",{staticClass:"row",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"col-12"},[e._v("No se obtuvieron resultados")])]):e._e()])])])])},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"col-12"},[a("h5",{staticClass:"float-left",staticStyle:{"font-size":"20px","padding-bottom":"10px"}},[a("b",[e._v("Reportes - Reporte localización")])])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card-header row"},[a("div",{staticClass:"col-6"},[a("h5",{staticClass:" float-left"},[e._v("Reporte localización")])])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"col-12 "},[a("h5",[e._v("Generar reporte")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"col-12",attrs:{id:"alertReport"}})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"col-12",attrs:{id:"wp-map"}},[a("h5",[e._v("Mapa")]),a("hr")])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"col-8 "},[a("h5",[e._v("Reportes")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",[a("th",[e._v("Fecha")]),a("th",[e._v("Dispositivo")]),a("th",[e._v("Reporte")]),a("th",[e._v("Ubicacion")]),a("th",[e._v("Dirección")]),a("th",[e._v("Velocidad (km/hr)")])])])}],r=(a("96cf"),a("3b8d")),o=(a("ac6a"),a("8615"),a("2b0e")),n=a("2347"),l=a.n(n),c=a("08e6"),p=a("d3e3"),m=a("511d"),u=a("b803"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:" container"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-fluid"},[a("h5",[e._v(e._s(e.report.alias))])]),a("div",{staticClass:"col-6"},[a("config-data-label",{attrs:{IDinput:"date",label:"Fecha:",value:e.GetTimeString(e.report.timestamp)}})],1),a("div",{staticClass:"col-6"},[a("config-data-label",{attrs:{IDinput:"reportType",label:"Reporte:",value:e.report.reportTypeString}})],1),a("div",{staticClass:"col-12"},[a("config-data-label",{attrs:{IDinput:"address",label:"Direccion:",value:e.report.address}})],1)])])},h=[],f={name:"infowindoswDispositivo",props:["report"],data:function(){return{}},created:function(){},methods:{GetTimeString:function(e){return this.$moment(1e3*e).format("LL HH:mm:ss a")}}},v=f,g=(a("14f6"),a("2877")),y=Object(g["a"])(v,d,h,!1,null,null,null),b=y.exports,_={name:"reporteLocalizacion",mixins:[c["a"],m["a"]],components:{JsonCsv:l.a,googleMaps:u["a"]},data:function(){return{placas:"",conductor:null,device:0,resultado:!1,ShowLoader:null,listDEvice:[],deviceImei:null,deviceAlias:"",reportsTable:[],reports:[],csvFields:["fechaString","deviceImeiString","alias","reportTypeString","lat","lng","address","speed"],csvLabels:{fechaString:"FECHA",deviceImeiString:"IMEI",alias:"ALIAS",reportTypeString:"REPORTE",lat:"LATITUD",lng:"LONGITUD",address:"DIRECCION",speed:"VELOCIDAD (Km/Hr)"},csvFileName:"",pageNo:1,pageSize:100,pageCount:0,pages:0,fechaInicio:"",fechaFinal:"",map:{show:!1,height:270,position:{lat:18.9240744,lng:-99.2252484},marker:{id:"marker"}}}},created:function(){this.$store.state.loader=!1,this.listDEvice=Object.values(this.$store.state.devices.devices)},mounted:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$store.state.seccionMenu="reportes",e.next=3,p["a"].$emit("NAVBAR_MenuSimple","reportes");case 3:$("#containerPrincipal").css({"margin-left":this.$store.state.widthMenu}),$("#containerPrincipal").css({"margin-top":this.$store.state.topMenu}),t=new Date,a=t.getDate(),s=t.getMonth(),i=t.getFullYear(),$("#date-end1").bootstrapMaterialDatePicker({weekStart:0,lang:"es",format:"MMMM DD, YYYY HH:mm:ss",shortTime:!0,year:!0,date:!0,time:!1,maxDate:this.$moment(new Date).endOf("day"),minDate:this.$moment(new Date).startOf("day")}),$("#date-start1").bootstrapMaterialDatePicker({weekStart:0,lang:"es",format:"MMMM DD, YYYY HH:mm:ss",currentDate:this.$moment(new Date).startOf("day"),maxDate:this.$moment(new Date).endOf("day"),shortTime:!0,year:!0,date:!0,time:!1}).on("change",(function(e,t){var r=new Date(t);this.fechaInicio=t;var o=r.getFullYear(),n=r.getDate();console.debug(this.fechaInicio,"fech sin formato",r);var l=r.getMonth(),c=r.setMonth(l+3),p=r.getMonth(),m=r.getFullYear();console.debug("actual",l,o),console.debug(r,"fecha mas3",p,m,"nueva fecha",c),m>i?(console.debug("año diferente",a,n),r=new Date):m==i&&(console.debug("mismo año"),p>l&&(r=new Date),p==s&&n>a&&(console.debug("dia mayor, mismo mes"),r=new Date)),console.debug("fecha FINAL",r),$("#date-end1").bootstrapMaterialDatePicker("setMinDate",t),$("#date-end1").bootstrapMaterialDatePicker("setMaxDate",r)})).on("change",(function(e,t){this.fechaFinal=t,console.debug("FECHA_FIANL",this.fechaFinal)})),this.$store.state.loader=!1;case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{OnMapReady:function(){this.$refs.map.setAllMapStyle(a("1ff1")),this.$refs.map.addMarker(this.map.marker.id,this.map.position.lat,this.map.position.lng,"default",null,""),this.$refs.map.setMarkerVisible(this.map.marker.id,!1)},ShowReportOnMap:function(e){this.map.show=!0;var t=o["a"].extend(b),a=new t({propsData:{report:e}});a.$mount(),this.$refs.map.setMarkerVisible(this.map.marker.id,!0),this.$refs.map.moveMarker(this.map.marker.id,e.lat,e.lng),this.$refs.map.setMarkerInfoWindow(this.map.marker.id,a.$el),this.$refs.map.showMarkerInfoWindow(this.map.marker.id),this.$refs.map.centerMap(e.lat,e.lng,16);var s="#wp-map";$("html, body").animate({scrollTop:$(s).offset().top-20},1e3)},cancel:function(){this.$router.push("/reports")},createReport:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,a,s,i,r,o,n,l,c,p=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=this.device&&"0"!=this.device){e.next=4;break}return $("#alertReport").html("<div class='alert alert-danger alert-dismissible fade show' role='alert' style='text-align: initial;'><strong>Error! </strong>Debe seleccionar un dispositivo<button type='button' class='close' data-dismiss='alert' aria-label='Close' style='padding-top: 0px;'><span aria-hidden='true'>&times;</span></button></div>"),setTimeout((function(){$("#alertReport").html("")}),3e3),e.abrupt("return",0);case 4:if(t={deviceID:parseInt(this.device),order:"DESC"},a=$("#date-start1").val(),s=$("#date-end1").val(),i=this.fechaEsp(a),r=this.fechaEsp(s),console.debug(i,"DATOS_PRINC",r),""!=i||""!=r){e.next=13;break}e.next=23;break;case 13:if(""==i||""==r){e.next=20;break}o=Date.parse(i)/1e3,n=Date.parse(r)/1e3,t.fromTimestamp=o,t.tillTimestamp=n,e.next=23;break;case 20:return $("#alertReport").html("<div class='alert alert-danger alert-dismissible fade show' role='alert' style='text-align: initial;'><strong>Error! </strong>Debe ingresar las 2 fechas<button type='button' class='close' data-dismiss='alert' aria-label='Close' style='padding-top: 0px;'><span aria-hidden='true'>&times;</span></button></div>"),setTimeout((function(){$("#alertReport").html("")}),3e3),e.abrupt("return",0);case 23:this.listDEvice.forEach((function(e){e.id==p.device&&(p.deviceImei=e.imei,p.deviceAlias=e.alias)})),this.reports=[],l="ReporteLocalizacion",c=parseInt(this.deviceImei),"190807",this.csvFileName="".concat(l," - ").concat(c,".csv"),this.ShowLoader=!0,this.$store.state.loader=!0,console.debug("FILTRO",t),this.getReports(t);case 33:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getReports:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getRequest("reports/historical",t);case 2:a=e.sent,a.data.reports.forEach((function(e){try{var t=s.$moment.unix(parseInt(e.timestamp));e.deviceImeiString="'"+e.deviceImei,e.fechaString=t.format("DD-MMM-YYYY HH:mm:ss")}catch(a){console.warn("Error parsing timestamp"),e.fechaString=t.format("No disponible")}})),this.reports=this.reports.concat(a.data.reports),a.pagination.next?(console.debug("NEXT"),t={paginationToken:a.pagination.next},this.getReports(t)):(console.debug("FINISH"),this.init(),this.ShowLoader=!1,this.$store.state.loader=!1,this.resultado=!0);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),init:function(){this.pages=this.count({}),this.pages=Math.ceil(this.pages/this.pageSize),this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize})},page:function(e){this.virtualService({pageNo:e,pageSize:this.pageSize})},first:function(){this.pageNo=1,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize})},last:function(){this.pageNo=this.pageCount,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize})},prev:function(){this.pageNo>1&&(this.pageNo-=1,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize}))},next:function(){console.debug("".concat(this.pageNo," < ").concat(this.pageCount)),this.pageNo<this.pageCount&&(this.pageNo+=1,this.virtualService({pageNo:this.pageNo,pageSize:this.pageSize}))},count:function(e){return this.reports.length},queryFromVirtualDB:function(e,t,a){var s=[];e={};this.count(e);return console.debug("GET REPORTS FROM ".concat(t," AT ").concat(a),e),s=this.reports.slice(t,a),s},virtualService:function(e){var t={},a=e.pageNo,s=e.pageSize,i=Math.ceil(this.count(t)/s);0==a&&(a=1),a<0?a=i:a>i&&(a=i);var r=(a-1)*s+1,o=r+s-1,n=this.queryFromVirtualDB(t,r,o);this.reportsTable=n,this.pageNo=a,this.pageCount=i}},computed:{showResultado:function(){return this.resultado}}},T=_,w=(a("6b8c"),Object(g["a"])(T,s,i,!1,null,null,null));t["default"]=w.exports},"14f6":function(e,t,a){"use strict";var s=a("0c77"),i=a.n(s);i.a},"1ff1":function(e){e.exports=JSON.parse('[{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#d6e2e6"}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#cfd4d5"}]},{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#7492a8"}]},{"featureType":"administrative.neighborhood","elementType":"labels.text.fill","stylers":[{"lightness":25}]},{"featureType":"landscape.man_made","elementType":"geometry.fill","stylers":[{"color":"#dde2e3"}]},{"featureType":"landscape.man_made","elementType":"geometry.stroke","stylers":[{"color":"#cfd4d5"}]},{"featureType":"landscape.natural","elementType":"geometry.fill","stylers":[{"color":"#dde2e3"}]},{"featureType":"landscape.natural","elementType":"labels.text.fill","stylers":[{"color":"#7492a8"}]},{"featureType":"landscape.natural.terrain","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"geometry.fill","stylers":[{"color":"#dde2e3"}]},{"featureType":"poi","elementType":"labels.icon","stylers":[{"saturation":-100}]},{"featureType":"poi","elementType":"labels.text.fill","stylers":[{"color":"#588ca4"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#a9de83"}]},{"featureType":"poi.park","elementType":"geometry.stroke","stylers":[{"color":"#bae6a1"}]},{"featureType":"poi.sports_complex","elementType":"geometry.fill","stylers":[{"color":"#c6e8b3"}]},{"featureType":"poi.sports_complex","elementType":"geometry.stroke","stylers":[{"color":"#bae6a1"}]},{"featureType":"road","elementType":"labels.icon","stylers":[{"saturation":-45},{"lightness":10},{"visibility":"on"}]},{"featureType":"road","elementType":"labels.text.fill","stylers":[{"color":"#41626b"}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#c1d1d6"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#a6b5bb"}]},{"featureType":"road.highway","elementType":"labels.icon","stylers":[{"visibility":"on"}]},{"featureType":"road.highway.controlled_access","elementType":"geometry.fill","stylers":[{"color":"#9fb6bd"}]},{"featureType":"road.local","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"transit","elementType":"labels.icon","stylers":[{"saturation":-70}]},{"featureType":"transit.line","elementType":"geometry.fill","stylers":[{"color":"#b4cbd4"}]},{"featureType":"transit.line","elementType":"labels.text.fill","stylers":[{"color":"#588ca4"}]},{"featureType":"transit.station","elementType":"labels.text.fill","stylers":[{"color":"#008cb5"}]},{"featureType":"transit.station.airport","elementType":"geometry.fill","stylers":[{"saturation":-100},{"lightness":-5}]},{"featureType":"water","elementType":"geometry.fill","stylers":[{"color":"#a6cbe3"}]}]')},"6b8c":function(e,t,a){"use strict";var s=a("ad8b"),i=a.n(s);i.a},ad8b:function(e,t,a){}}]);
//# sourceMappingURL=chunk-ee17524c.cb8f5903.js.map