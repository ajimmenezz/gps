(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b2e9b"],{"25ac":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.draggable.show?i("draggable",{attrs:{name:e.draggable.name,top:e.draggable.top,left:e.draggable.left,width:e.draggable.width,height:e.draggable.height,zindex:e.draggable.index}},[i("draggable-header",[i("div",{staticClass:"col-12 m-content",style:{height:e.draggable.header.height+"px"}},[i("div",{staticClass:"row m-content-header"},[i("div",{staticClass:"col-1 size-movile",staticStyle:{padding:"0px","padding-top":"10px"},on:{click:function(t){return e.close()}}},[i("i",{staticClass:"icon icon-lg universalicon-arrow-left cursor"})]),i("div",{staticClass:"col-8 text-left",staticStyle:{padding:"15px"}},[i("h5",{staticStyle:{color:"white !important"}},[e._v("Lista dispositivos")])]),i("div",{staticClass:"col-3 text-right"},[i("i",{staticClass:"icon icon-md universalicon-help cursor test",staticStyle:{position:"relative",top:"10px"},attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-delay":"{'show':250, 'hide':1000}","data-html":"true","data-template":"<div class='tooltip fluid' role='tooltip'><div class='arrow'></div><div class='tooltip-inner'></div></div>",title:"<div class='alert-info text-left' style='padding:5px 10px;'>\n              El semaforo indica el tiempo del ultimo reporte de la unidad: <br />\n              <span class='badge badge-pill badge-success'>&nbsp;</span> Menos 12 horas<br />\n              <span class='badge badge-pill badge-warning'>&nbsp;</span> Menos 24 horas <br />\n              <span class='badge badge-pill badge-danger'>&nbsp;</span> Mas de 24 horas\n            </div>"}},[e._v(" ")])])]),i("div",{staticClass:"row",staticStyle:{"padding-top":"15px"}},[i("div",{staticClass:"col-12"},[i("div",{staticClass:"form-group col-9",staticStyle:{"margin-bottom":"0.5rem","margin-left":"auto","margin-right":"auto"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.deviceList.searchTerm,expression:"deviceList.searchTerm"}],staticClass:"form-control classdisabled toupperCase",staticStyle:{padding:"6px 12px",background:"white"},attrs:{type:"text",placeholder:"Buscar por unidad o flotilla"},domProps:{value:e.deviceList.searchTerm},on:{input:[function(t){t.target.composing||e.$set(e.deviceList,"searchTerm",t.target.value)},function(t){return e.FilterDeviceList()}]}})])]),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.helper.showResetDeviceListButton,expression:"helper.showResetDeviceListButton"}],staticClass:"col-12"},[i("span",{staticClass:"badge badge-pill badge-info cursor-pointer",on:{click:function(t){return e.ResetDeviceListFilter()}}},[e._v("Mostrar todas las unidades")])])]),i("div",{staticClass:"col-12"},[i("hr")])],1)])]),i("draggable-content",[i("div",{staticClass:"col-12 m-content",style:{height:e.draggable.maxContentHeight+"px"}},e._l(e.deviceList.filteredList,(function(t){return i("div",{key:t.id,staticClass:"row"},[i("div",{staticClass:"col-12 text-left",staticStyle:{"word-break":"break-all"}},[i("span",{staticClass:"cursor-pointer",on:{click:function(i){return e.ToggleCollapseFleet(t.id)}}},[i("small",[e._v(e._s(t.name))]),i("i",{staticClass:"icon-small universalicon-arrow-collapse",staticStyle:{position:"absolute",bottom:"-2px","margin-left":"6px"},attrs:{id:"fleet-"+t.id+"-collapse-icon"}},[e._v(" ")])])]),i("div",{staticClass:"col-12 collapse show",attrs:{id:"fleet-"+t.id}},[t.devices.length>0?i("ul",{staticClass:"list-group list-group-flush"},e._l(t.devices,(function(t){return i("li",{key:t.imei,staticClass:"list-group-item"},[i("div",{staticClass:"row",on:{click:function(i){return e.ShowDevice(t.imei)}}},[i("div",{staticClass:"col-12 text-left col-fluid"},[i("div",{staticStyle:{display:"inline-block","margin-left":"5px","margin-right":"15px"}},[i("span",{staticClass:"dot",class:[1==t.locationStatus?"bg-success":"",2==t.locationStatus?"bg-warning":"",3==t.locationStatus?"bg-danger":""],staticStyle:{position:"absolute",top:"6px"}},[e._v(" ")])]),e._v("\n                    "+e._s(t.alias)+"\n                  ")])])])})),0):i("div",{staticClass:"float-center"},[i("small",[e._v("Sin Dispositivos")])])])])})),0)]),i("draggable-bottom",[i("div",{staticClass:"col-12 m-content",style:{height:e.draggable.bottom.height+"px"}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("hr")]),i("div",{staticClass:"col-12 m-content text-center"},[i("div",{directives:[{name:"show",rawName:"v-show",value:this.deviceList.totalSelected>0,expression:"this.deviceList.totalSelected > 0"}]},[i("span",{staticClass:"badge badge-pill badge-info"},[e._v(e._s(this.deviceList.totalSelected))]),e._v(" Seleccionados\n        ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:this.deviceList.totalSelected<1,expression:"this.deviceList.totalSelected < 1"}]},[i("div",{staticClass:"float-left",on:{click:function(t){return e.FilterDeviceListByReportState(!0)}}},[i("span",{staticClass:"badge badge-pill badge-success cursor-pointer",attrs:{"data-toggle":"tooltip","data-placement":"top","data-delay":"500",title:"Unidades ubicadas"}},[e._v(e._s(this.$store.getters["devices/TOTAL_LOCATE"]))]),e._v("\n          Ubicados\n          ")]),i("div",{staticClass:"float-right",on:{click:function(t){return e.FilterDeviceListByReportState(!1)}}},[i("span",{staticClass:"badge badge-pill badge-danger cursor-pointer",staticStyle:{"margin-left":"15px"},attrs:{"data-toggle":"tooltip","data-placement":"top","data-delay":"500",title:"Unidades sin ubicar"}},[e._v(e._s(this.$store.getters["devices/TOTAL_DISLOCATE"]))]),e._v("\n          Sin ubicar\n          ")])])])])])])],1):e._e()],1)},a=[],o=(i("6762"),i("2fdb"),i("7f7f"),i("8615"),i("ac6a"),i("7514"),i("d3e3")),n=i("a1b0"),c={name:"DevicePanel",components:{draggable:n["a"],draggableHeader:n["d"],draggableContent:n["c"],draggableBottom:n["b"]},data:function(){return{map:null,helper:{showResetDeviceListButton:!1},deviceList:{searchTerm:null,list:[],filteredList:[],totalSelected:0,filterByReportStatus:null,actionButtons:{setEngine:this.$store.getters.permission(4)}},draggable:{name:"ListDevicesMobile",top:0,height:0,width:0,left:0,index:99,maxHeightScroll:0,show:!0,maxContentHeight:0,marginTop:0,background:!1,header:{height:140},bottom:{height:75}}}},inject:["getMap","showDeviceInfo","closeDeviceInfo","loadDynamicComponent","onDevicesSelected","showDeviceInfoMovil"],mounted:function(){this.InitializeDeviceList(),this.DeviceReportStateControl(),this.RegisterTooltip(),this.UpdateTotalDevicesSelected(),this.SuscribeDeviceEvents(),this.OnWindowResize(),$(window).resize(this.OnWindowResize)},beforeDestroy:function(){this.UnsuscribeDeviceEvents()},methods:{OnWindowResize:function(){var e=$(window).width(),t=$(window).height();this.draggable.left=0,this.draggable.top=0,this.draggable.width=e,this.draggable.height=t-(this.draggable.header.height+this.draggable.bottom.height),this.draggable.maxContentHeight=t-(this.draggable.header.height+this.draggable.bottom.height),this.$store.state.typeDevice.tablet&&e>t&&(this.$store.state.typeDevice.isHorizontal=!0),console.debug("onWindowResize",this.draggable)},SuscribeDeviceEvents:function(){var e=this;this.map=this.getMap(),console.debug("SuscribeToMapEvents",this.map),o["a"].$on("MapModule_OpenInfowindowsDevices",(function(t){e.ClearDeviceSelection();var i=e.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return e.imei===t}));e.OnDeviceSelectionChanged(i.id,!0,i.fleetID)})),o["a"].$on("MapModule_CloseInfowindowsDevices",(function(t){var i=e.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return e.imei===t}));e.OnDeviceSelectionChanged(i.id,!1,i.fleetID)})),o["a"].$on("Ws_LOCATE_SELECT",(function(e){console.debug("DeviceListPanel","WSLocateSelect",e)})),o["a"].$on("deviceList_locationsStatusDevices",(function(e){console.debug("DeviceListPanel","DeviceListLocationStatusDevices",e)})),o["a"].$on("openInfowindowsDevicesROUTER",(function(e){console.debug("DeviceListPanel","openInfoWindowsDevicesROUTER",e)})),o["a"].$on("EventGetbuscador",(function(t){console.debug("DeviceListPanel","EventGetBuscador",t),e.deviceList.searchTerm=t,e.FilterDeviceList()}))},UnsuscribeDeviceEvents:function(){o["a"].$off("MapModule_CloseInfowindowsDevices"),o["a"].$off("MapModule_OpenInfowindowsDevices"),o["a"].$off("Ws_LOCATE_SELECT"),o["a"].$off("deviceList_locationsStatusDevices"),o["a"].$off("openInfowindowsDevicesROUTER")},RegisterTooltip:function(){jQuery(document).ready((function(){jQuery('[data-toggle="tooltip"]').tooltip()}))},InitializeDeviceList:function(){var e=this;this.$store.state.devices.fleets.forEach((function(t){var i=Object.values(e.$store.state.devices.devices).filter((function(e){return e.fleetID===t.id})),s={id:t.id,name:t.name,devices:i,collapsed:!1,selected:!1};console.debug("Fleet",s.name,s.devices),e.deviceList.filteredList.push(s),e.deviceList.list.push(s);var a=e.HasFleetAllDevicesSelected(s.id);s.selected=a}))},DeviceReportStateControl:function(){this.UpdateDeviceLocationStatus();var e=6e4;setInterval(this.UpdateDeviceLocationStatus,e)},UpdateDeviceLocationStatus:function(){Object.values(this.$store.state.devices.devices).forEach((function(e){var t=43200,i=86400,s=Math.floor(Date.now()/1e3),a=s-e.report.timestamp;e.locationStatus=a<=t?1:a<=i?2:3}))},ClearDeviceSelection:function(){this.deviceList.list.forEach((function(e){e.selected=!1,e.devices.forEach((function(e){e.selected=!1}))}))},OnFleetSelectionChanged:function(e,t){var i=this.deviceList.filteredList.find((function(t){return t.id===e}));i.selected=t,console.debug("FleetSelectionChanged",i,e,t),i.devices.forEach((function(e){e.selected=t,console.debug("Seleccionando",e.id,t)})),this.UpdateTotalDevicesSelected(),i.selected},OnDeviceSelectionChanged:function(e,t){var i,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!=a?(s=this.deviceList.list.find((function(e){return e.id===a})),i=s.devices.find((function(t){return t.id===e}))):(i=this.deviceList.list.flatMap((function(e){return e.devices})).find((function(t){return t.id===e})),s=this.deviceList.list.find((function(e){return e.id===i.fleetID}))),i.selected=t;var o=this.HasFleetAllDevicesSelected(i.fleetID);s.selected=o,this.UpdateTotalDevicesSelected()},HasFleetAllDevicesSelected:function(e){var t=this.deviceList.list.find((function(t){return t.id===e}));return t.devices.length>0&&t.devices.every((function(e){return!0===e.selected}))},ResetDeviceListFilter:function(){this.deviceList.searchTerm="",this.deviceList.filteredList=this.deviceList.list,this.helper.showResetDeviceListButton=!1},FilterDeviceList:function(){var e=this;if(""===this.deviceList.searchTerm.trim())this.ResetDeviceListFilter();else{var t=[];this.deviceList.list.forEach((function(i){if(i.name.toLowerCase().includes(e.deviceList.searchTerm.toLowerCase()))t.push(i);else{var s=Object.assign({},i);s.devices=i.devices.filter((function(t){return t.alias.toLowerCase().includes(e.deviceList.searchTerm.toLowerCase())})),s.devices.length>0&&t.push(s)}})),this.helper.showResetDeviceListButton=!0,this.deviceList.filteredList=t,this.RegisterTooltip()}},FilterDeviceListByReportState:function(e){var t=this;this.ResetDeviceListFilter();var i=[];this.deviceList.list.forEach((function(s){var a=Object.assign({},s);a.devices=s.devices.filter((function(i){return e?t.$store.state.devices.devices[i.imei].locationStatus<3:3===t.$store.state.devices.devices[i.imei].locationStatus})),a.devices.length>0&&i.push(a)})),this.helper.showResetDeviceListButton=!0,this.deviceList.filteredList=i,this.RegisterTooltip()},UpdateTotalDevicesSelected:function(){var e=this,t=[];if(this.deviceList.totalSelected=0,this.deviceList.list.forEach((function(i){i.devices.forEach((function(i){i.selected&&(e.deviceList.totalSelected++,t.push({deviceImei:i.imei}))}))})),1===this.deviceList.totalSelected){var i=this.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return!0===e.selected}));this.showDeviceInfo(i.imei)}else this.deviceList.totalSelected>1?(this.closeDeviceInfo(),this.onDevicesSelected(t)):(this.closeDeviceInfo(),this.onDevicesSelected([]))},ShowDeviceRoutePanel:function(){if(1===this.deviceList.totalSelected){var e=this.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return!0===e.selected}));console.debug("ShowDeviceRoute of",e);var t=function(){return Promise.all([i.e("chunk-2d0b217a"),i.e("chunk-61512086")]).then(i.bind(null,"0db4"))},s={deviceID:e.imei,buscador:this.deviceList.searchTerm};this.loadDynamicComponent("deviceRoute",t,s)}},ToggleCollapseFleet:function(e){var t="#fleet-"+e,i="#fleet-"+e+"-collapse-icon",s=$(t).hasClass("show");s?($(t).collapse("hide"),$(i).removeClass("universalicon-arrow-collapse"),$(i).addClass("universalicon-arrow-expand")):($(t).collapse("show"),$(i).addClass("universalicon-arrow-collapse"),$(i).removeClass("universalicon-arrow-expand"))},ShowDevice:function(e){this.showDeviceInfoMovil(e)},close:function(){this.$emit("closeList")}}},l=c,d=i("2877"),r=Object(d["a"])(l,s,a,!1,null,null,null);t["default"]=r.exports}}]);
//# sourceMappingURL=chunk-2d0b2e9b.1df611ed.js.map