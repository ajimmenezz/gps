(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22dcf7"],{f8a0:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container-fluid",staticStyle:{"margin-top":"15px","margin-bottom":"5px"}},[e._m(0),i("div",{staticClass:"row",staticStyle:{"margin-top":"5px"}},[i("div",{staticClass:"col-10"},[i("div",{staticClass:"form-group",staticStyle:{"margin-bottom":"0.5rem"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.deviceList.searchTerm,expression:"deviceList.searchTerm"}],staticClass:"form-control classdisabled toupperCase",staticStyle:{padding:"6px 12px"},attrs:{type:"text",placeholder:"Buscar por unidad o flotilla"},domProps:{value:e.deviceList.searchTerm},on:{input:[function(t){t.target.composing||e.$set(e.deviceList,"searchTerm",t.target.value)},function(t){return e.FilterDeviceList()}]}})])]),i("div",{staticClass:"col-2 col-fluid text-left"},[i("i",{staticClass:"icon-md universalicon-target-fixed cursor-pointer",attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-delay":"500",title:"Localizar todas las unidades"},on:{click:function(t){return e.LocateAllDevices()}}},[e._v(" ")])]),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.helper.showResetDeviceListButton,expression:"helper.showResetDeviceListButton"}],staticClass:"col-12"},[i("span",{staticClass:"badge badge-pill badge-info cursor-pointer",on:{click:function(t){return e.ResetDeviceListFilter()}}},[e._v("\n        Mostrar todas las unidades\n      ")])])]),e._m(1)],1),i("div",{staticClass:"row",staticStyle:{"overflow-y":"auto","max-height":"200px"}},[i("div",{staticClass:"col-12"},e._l(e.deviceList.filteredList,(function(t){return i("div",{key:t.id,staticClass:"row"},[i("div",{staticClass:"col-9 text-left custom-control custom-checkbox",staticStyle:{"margin-left":"10px","word-break":"break-all"}},[i("input",{staticClass:"custom-control-input cursor-pointer",attrs:{id:"fleetCheckbox-"+t.id,type:"checkbox"},domProps:{checked:t.selected},on:{input:function(i){return e.OnFleetSelectionChanged(t.id,i.target.checked)}}}),i("label",{staticClass:"custom-control-label cursor-pointer",attrs:{for:"fleetCheckbox-"+t.id}}),i("span",{staticClass:"cursor-pointer",on:{click:function(i){return e.ToggleCollapseFleet(t.id)}}},[i("small",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.name))]),i("i",{staticClass:"icon-small universalicon-arrow-collapse",staticStyle:{position:"absolute",bottom:"-2px","margin-left":"6px"},attrs:{id:"fleet-"+t.id+"-collapse-icon"}},[e._v(" ")])])]),i("div",{staticClass:"col-2"},[i("i",{directives:[{name:"show",rawName:"v-show",value:t.selected,expression:"fleet.selected"}],staticClass:"icon icon-small universalicon-target-fixed cursor-pointer",attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-delay":"500",title:"Localizar unidades de la flotilla"},on:{click:function(i){return e.LocateFleet(t.id)}}})]),i("div",{staticClass:"col-12 collapse show",attrs:{id:"fleet-"+t.id}},[t.devices.length>0?i("ul",{staticClass:"list-group list-group-flush"},e._l(t.devices,(function(s){return i("li",{key:s.imei,staticClass:"list-group-item"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-1 col-fluid"},[i("div",{staticClass:"custom-control custom-checkbox",staticStyle:{display:"inline-block"}},[i("input",{staticClass:"custom-control-input cursor-pointer",attrs:{id:"deviceCheckbox-"+s.id,type:"checkbox","data-type":"device"},domProps:{checked:s.selected},on:{input:function(i){return e.OnDeviceSelectionChanged(s.id,i.target.checked,t.id)}}}),i("label",{staticClass:"custom-control-label cursor-pointer",attrs:{for:"deviceCheckbox-"+s.id}})])]),i("div",{staticClass:"col-8 text-left col-fluid"},[i("div",{staticStyle:{display:"inline-block","margin-left":"5px","margin-right":"15px"}},[i("span",{staticClass:"dot",class:[1==s.locationStatus?"bg-success":"",2==s.locationStatus?"bg-warning":"",3==s.locationStatus?"bg-danger":""],staticStyle:{position:"absolute",top:"6px"}},[e._v(" ")])]),e._v("\n                  "+e._s(s.alias)+"\n                ")]),i("div",{staticClass:"col-3 col-fluid text-right"},[i("i",{staticClass:"icon icon-small universalicon-target-fixed cursor-pointer",attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-delay":"500",title:"Localizar unidad"},on:{click:function(t){return e.LocateDevices([s.imei])}}},[e._v(" ")]),e.deviceList.actionButtons.setEngine?i("i",{staticClass:"icon icon-small universalicon-shutdown cursor-pointer",attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-delay":"500",title:"Realizar paro o encendido de motor"},on:{click:function(t){return e.SetEngine(s.id)}}},[e._v(" ")]):e._e()])])])})),0):i("div",{staticClass:"float-center"},[i("small",[e._v("Sin Dispositivos")])])])])})),0)]),i("div",{staticClass:"row"},[e._m(2),i("div",{staticClass:"col-4"},[i("span",{staticClass:"badge badge-pill",class:[1===this.deviceList.totalSelected?"badge-info":"badge-secondary",1===this.deviceList.totalSelected?"cursor-pointer":"cursor-not-allowed"],on:{click:function(t){return e.ShowDeviceRoutePanel()}}},[i("i",{staticClass:"icon universalicon-polyline"}),e._v(" Recorrido\n      ")])]),i("div",{staticClass:"col-8 text-right"},[i("div",{directives:[{name:"show",rawName:"v-show",value:this.deviceList.totalSelected>0,expression:"this.deviceList.totalSelected > 0"}]},[i("span",{staticClass:"badge badge-pill badge-info"},[e._v(e._s(this.deviceList.totalSelected))]),e._v(" Seleccionados\n      ")]),i("div",{directives:[{name:"show",rawName:"v-show",value:this.deviceList.totalSelected<1,expression:"this.deviceList.totalSelected < 1"}]},[i("span",{staticClass:"badge badge-pill badge-success cursor-pointer",attrs:{"data-toggle":"tooltip","data-placement":"top","data-delay":"500",title:"Unidades ubicadas"},on:{click:function(t){return e.FilterDeviceListByReportState(!0)}}},[e._v(e._s(this.$store.getters["devices/TOTAL_LOCATE"]))]),i("span",{staticClass:"badge badge-pill badge-danger cursor-pointer",staticStyle:{"margin-left":"15px"},attrs:{"data-toggle":"tooltip","data-placement":"top","data-delay":"500",title:"Unidades sin ubicar"},on:{click:function(t){return e.FilterDeviceListByReportState(!1)}}},[e._v(e._s(this.$store.getters["devices/TOTAL_DISLOCATE"]))])])])])])},a=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"row"},[i("div",{staticClass:"col-8 text-left"},[i("h5",[e._v("Dispositivos")])]),i("div",{staticClass:"col-4 text-right"},[i("i",{staticClass:"icon icon-small universalicon-help cursor test",attrs:{"data-toggle":"tooltip","data-placement":"bottom","data-delay":'{"show":500, "hide":1000}',"data-html":"true","data-template":'<div class="tooltip fluid" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',title:'<div class="alert-info text-left" style="padding:5px 10px;">\n          El semaforo indica el tiempo del ultimo reporte de la unidad:\n          <br />\n          <span class="badge badge-pill badge-success">&nbsp;</span> Menos 12 horas\n          <br />\n          <span class="badge badge-pill badge-warning">&nbsp;</span> Menos 24 horas\n          <br />\n          <span class="badge badge-pill badge-danger">&nbsp;</span> Mas de 24 horas\n        </div>'}},[e._v(" ")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"col-12"},[i("hr")])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"col-12"},[i("hr")])}],o=(i("6762"),i("2fdb"),i("7f7f"),i("96cf"),i("3b8d")),c=(i("8615"),i("ac6a"),i("7514"),i("d3e3")),n={name:"DevicePanel",data:function(){return{map:null,helper:{showResetDeviceListButton:!1},deviceList:{searchTerm:null,list:[],filteredList:[],totalSelected:0,filterByReportStatus:null,actionButtons:{setEngine:this.$store.getters.permission(4)}}}},inject:["getMap","showDeviceInfo","closeDeviceInfo","loadDynamicComponent","onDevicesSelected"],mounted:function(){this.InitializeDeviceList(),this.DeviceReportStateControl(),this.RegisterTooltip(),this.UpdateTotalDevicesSelected(),this.SuscribeDeviceEvents()},beforeDestroy:function(){this.UnsuscribeDeviceEvents()},methods:{SuscribeDeviceEvents:function(){var e=this;this.map=this.getMap(),console.debug("SuscribeToMapEvents",this.map),c["a"].$on("MapModule_OpenInfowindowsDevices",(function(t){e.ClearDeviceSelection();var i=e.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return e.imei===t}));e.OnDeviceSelectionChanged(i.id,!0,i.fleetID)})),c["a"].$on("MapModule_CloseInfowindowsDevices",(function(t){var i=e.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return e.imei===t}));e.OnDeviceSelectionChanged(i.id,!1,i.fleetID)})),c["a"].$on("Ws_LOCATE_SELECT",(function(e){console.debug("DeviceListPanel","WSLocateSelect",e)})),c["a"].$on("deviceList_locationsStatusDevices",(function(e){console.debug("DeviceListPanel","DeviceListLocationStatusDevices",e)})),c["a"].$on("openInfowindowsDevicesROUTER",(function(e){console.debug("DeviceListPanel","openInfoWindowsDevicesROUTER",e)})),c["a"].$on("EventGetbuscador",(function(t){console.debug("DeviceListPanel","EventGetBuscador",t),e.deviceList.searchTerm=t,e.FilterDeviceList()}))},UnsuscribeDeviceEvents:function(){c["a"].$off("MapModule_CloseInfowindowsDevices"),c["a"].$off("MapModule_OpenInfowindowsDevices"),c["a"].$off("Ws_LOCATE_SELECT"),c["a"].$off("deviceList_locationsStatusDevices"),c["a"].$off("openInfowindowsDevicesROUTER")},RegisterTooltip:function(){jQuery(document).ready((function(){jQuery('[data-toggle="tooltip"]').tooltip()}))},LocateAllDevices:function(){var e=[];Object.values(this.$store.state.devices.devices).forEach((function(t){e.push(t.imei)})),this.LocateDevices(e)},LocateFleet:function(e){var t=[];Object.values(this.$store.state.devices.devices).filter((function(i){i.fleetID===e&&t.push(i.imei)})),this.LocateDevices(t)},LocateDevices:function(e){var t=this;if(console.debug("LocateDevices",e),this.$store.state.ws.connected){e.forEach((function(e){var i={imei:e};t.$store.dispatch("ws/LOCATE",i)}));var i="<b>Localizar unidades</b><br>\n        El comando se ha enviado a las unidades";1===e.length&&(i="<b>Localizar unidad</b><br>\n        El comando se ha enviado a la unidad"),notify("",i,"top","right","dark",340,this.$store.state.menu.topMenu)}else notify("<b>Servidor fuera de linea</b><br>","No podemos realizar la peticion en este momento, porfavor intente mas tarde","top","right","danger",340,this.$store.state.menu.topMenu)},SetEngine:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$store.commit("CLEAR_MODAL_DINAMIC"),s=this.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return e.id===t})),a={component:function(){return Promise.all([i.e("chunk-4fb8fb0b"),i.e("chunk-2d0f0681")]).then(i.bind(null,"9bdf"))},datos:{deviceImei:s.imei,stateParoMotor:!1,topMenu:0,leftMenu:0}},e.next=5,this.$store.commit("ADD_COMPONENT_DINAMIC",a);case 5:return e.next=7,this.$store.commit("ADD_COMPONENT_DINAMIC_STATE",!0);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),InitializeDeviceList:function(){var e=this;this.$store.state.devices.fleets.forEach((function(t){var i=Object.values(e.$store.state.devices.devices).filter((function(e){return e.fleetID===t.id})),s={id:t.id,name:t.name,devices:i,collapsed:!1,selected:!1};console.debug("Fleet",s.name,s.devices),e.deviceList.filteredList.push(s),e.deviceList.list.push(s);var a=e.HasFleetAllDevicesSelected(s.id);s.selected=a}))},DeviceReportStateControl:function(){this.UpdateDeviceLocationStatus();var e=6e4;setInterval(this.UpdateDeviceLocationStatus,e)},UpdateDeviceLocationStatus:function(){Object.values(this.$store.state.devices.devices).forEach((function(e){var t=43200,i=86400,s=Math.floor(Date.now()/1e3),a=s-e.report.timestamp;e.locationStatus=a<=t?1:a<=i?2:3}))},ClearDeviceSelection:function(){this.deviceList.list.forEach((function(e){e.selected=!1,e.devices.forEach((function(e){e.selected=!1}))}))},OnFleetSelectionChanged:function(e,t){var i=this.deviceList.filteredList.find((function(t){return t.id===e}));i.selected=t,console.debug("FleetSelectionChanged",i,e,t),i.devices.forEach((function(e){e.selected=t,console.debug("Seleccionando",e.id,t)})),this.UpdateTotalDevicesSelected(),i.selected},OnDeviceSelectionChanged:function(e,t){var i,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!=a?(s=this.deviceList.list.find((function(e){return e.id===a})),i=s.devices.find((function(t){return t.id===e}))):(i=this.deviceList.list.flatMap((function(e){return e.devices})).find((function(t){return t.id===e})),s=this.deviceList.list.find((function(e){return e.id===i.fleetID}))),i.selected=t;var o=this.HasFleetAllDevicesSelected(i.fleetID);s.selected=o,this.UpdateTotalDevicesSelected()},HasFleetAllDevicesSelected:function(e){var t=this.deviceList.list.find((function(t){return t.id===e}));return t.devices.length>0&&t.devices.every((function(e){return!0===e.selected}))},ResetDeviceListFilter:function(){this.deviceList.searchTerm="",this.deviceList.filteredList=this.deviceList.list,this.helper.showResetDeviceListButton=!1},FilterDeviceList:function(){var e=this;if(""===this.deviceList.searchTerm.trim())this.ResetDeviceListFilter();else{var t=[];this.deviceList.list.forEach((function(i){if(i.name.toLowerCase().includes(e.deviceList.searchTerm.toLowerCase()))t.push(i);else{var s=Object.assign({},i);s.devices=i.devices.filter((function(t){return t.alias.toLowerCase().includes(e.deviceList.searchTerm.toLowerCase())})),s.devices.length>0&&t.push(s)}})),this.helper.showResetDeviceListButton=!0,this.deviceList.filteredList=t,this.RegisterTooltip()}},FilterDeviceListByReportState:function(e){var t=this;this.ResetDeviceListFilter();var i=[];this.deviceList.list.forEach((function(s){var a=Object.assign({},s);a.devices=s.devices.filter((function(i){return e?t.$store.state.devices.devices[i.imei].locationStatus<3:3===t.$store.state.devices.devices[i.imei].locationStatus})),a.devices.length>0&&i.push(a)})),this.helper.showResetDeviceListButton=!0,this.deviceList.filteredList=i,this.RegisterTooltip()},UpdateTotalDevicesSelected:function(){var e=this,t=[];if(this.deviceList.totalSelected=0,this.deviceList.list.forEach((function(i){i.devices.forEach((function(i){i.selected&&(e.deviceList.totalSelected++,t.push({deviceImei:i.imei}))}))})),1===this.deviceList.totalSelected){var i=this.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return!0===e.selected}));this.showDeviceInfo(i.imei)}else this.deviceList.totalSelected>1?(this.closeDeviceInfo(),this.onDevicesSelected(t)):(this.closeDeviceInfo(),this.onDevicesSelected([]))},ShowDeviceRoutePanel:function(){if(1===this.deviceList.totalSelected){var e=this.deviceList.list.flatMap((function(e){return e.devices})).find((function(e){return!0===e.selected}));console.debug("ShowDeviceRoute of",e);var t=function(){return Promise.all([i.e("chunk-2d0b217a"),i.e("chunk-61512086")]).then(i.bind(null,"0db4"))},s={deviceID:e.imei,buscador:this.deviceList.searchTerm};this.loadDynamicComponent("deviceRoute",t,s)}},ToggleCollapseFleet:function(e){var t="#fleet-"+e,i="#fleet-"+e+"-collapse-icon",s=$(t).hasClass("show");s?($(t).collapse("hide"),$(i).removeClass("universalicon-arrow-collapse"),$(i).addClass("universalicon-arrow-expand")):($(t).collapse("show"),$(i).addClass("universalicon-arrow-collapse"),$(i).removeClass("universalicon-arrow-expand"))}}},l=n,r=i("2877"),d=Object(r["a"])(l,s,a,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-2d22dcf7.1e70db9b.js.map