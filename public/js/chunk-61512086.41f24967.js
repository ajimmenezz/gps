(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-61512086"],{"0db4":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container-fluid",staticStyle:{"margin-top":"15px","margin-bottom":"10px"}},[t.loader.show?i("loader-small",{attrs:{message:t.loader.message}}):t._e(),i("div",{staticClass:"row"},[t._m(0),t.showForm||t.error?t._e():i("div",{staticClass:"col-8 text-right"},[t.animationRoute.showPlayBtn?i("span",{staticClass:"universalicon-play icon icon-md text-secondary cursor cssToolTipp",on:{click:function(e){t.playAnimationRoute(),t.setAnimationRouteButtons(!1,!0,!0)}}},[i("p",{staticStyle:{top:"25px !important",right:"-70% !important"}},[t._v("Iniciar animación de recorrido")])]):t._e(),t.animationRoute.showStopBtn?i("span",{staticClass:"universalicon-play-stop icon icon-md text-secondary cursor cssToolTipp",on:{click:function(e){t.stopAnimationRoute(),t.setAnimationRouteButtons(!1,!1,!1)}}},[i("p",{staticStyle:{top:"25px !important",right:"-70% !important"}},[t._v("Detener animación de recorrido")])]):t._e(),t.animationRoute.showSpeedBtn?i("span",{staticClass:"universalicon-forward-x1 icon icon-md text-secondary cursor cssToolTipp",attrs:{id:"speedAnimationRouteBtn"},on:{click:function(e){return t.nextSpeedAnimationRoute()}}},[i("p",{staticStyle:{top:"25px !important",right:"-70% !important"}},[t._v("Cambiar a velocidad animacion "+t._s(t.animationRoute.speedBtnText))])]):t._e(),null!=t.animationRoute.timestamp&&t.animationRoute.showStopBtn?i("small",{staticClass:"flashit",staticStyle:{"margin-left":"8px",position:"relative",top:"-5px"}},[i("b",[t._v(t._s(t._f("moment")(1e3*t.animationRoute.timestamp,"hh:mm:ss a")))])]):t._e()]),t.showForm?t._e():i("div",{staticClass:"col-12 text-left text-ellipsis"},[t._v("\n      Unidad: "),i("b",[t._v(t._s(t.device.alias))])]),t._m(1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showForm,expression:"showForm"}],staticClass:"row text-left",staticStyle:{"max-height":"180px","overflow-y":"auto"}},[i("div",{staticClass:"col-12"},[i("label",{attrs:{for:"device"}},[t._v("Dispositivo")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.device.alias,expression:"device.alias"}],staticClass:"form-control mb-3 cursor-not-allowed",attrs:{type:"text",id:"device",disabled:""},domProps:{value:t.device.alias},on:{input:function(e){e.target.composing||t.$set(t.device,"alias",e.target.value)}}})]),i("div",{staticClass:"col-12"},[i("label",{attrs:{for:"date-report"}},[t._v("Seleccione una fecha de inicio:")]),i("input",{staticClass:"form-control mb-3 cursor",attrs:{id:"date-report",type:"text"},domProps:{value:t._f("moment")(t.fromTimestamp,"LLL a")}})]),i("div",{staticClass:"col-12"},[i("label",{attrs:{for:"date-end-report"}},[t._v("Seleccione una fecha de final:")]),i("input",{staticClass:"form-control mb-3 cursor",attrs:{id:"date-end-report",type:"text"},domProps:{value:t._f("moment")(t.tillTimestamp,"LLL a")}})])]),t.showForm||t.error?t._e():i("div",{staticClass:"row",staticStyle:{"max-height":"180px","overflow-y":"auto"},attrs:{id:"divContainerDos"}},[t.showReports?i("ul",{staticClass:"list-unstyled"},t._l(t.reports,(function(e,s){return i("li",{key:s,staticClass:"text-left",staticStyle:{"margin-bottom":"10px"}},[i("div",{staticClass:"row",staticStyle:{"margin-left":"5px","margin-right":"10px"},attrs:{id:"item"+e.id}},[t.animationRoute.showPlayBtn?i("div",{staticClass:"col-2 custom-control custom-radio",staticStyle:{"padding-left":"40px"}},["PARKING"==e.event?i("input",{staticClass:"custom-control-input",attrs:{type:"radio",id:e.id,name:"customRadio"},domProps:{value:e.id},on:{change:function(i){return t.onViewRoute(e.id,e.event,e.reports[0].lat,e.reports[0].lng)}}}):t._e(),"PARKING"!=e.event?i("input",{staticClass:"custom-control-input",attrs:{type:"radio",id:e.id,name:"customRadio"},domProps:{value:e.id},on:{change:function(i){return t.onViewRoute(e.id,e.event)}}}):t._e(),i("label",{staticClass:"custom-control-label",attrs:{for:e.id}},[t._v(" ")])]):t._e(),i("div",{staticClass:"col-8",staticStyle:{"padding-left":"0px"}},[i("b",[t._v(t._s(e.eventString))])]),i("div",{staticClass:"col-12 text-left"},[t._v("Velocidad Promedio: "),i("b",[t._v(t._s(Math.ceil(e.speed))+" Km/Hr.")])]),i("div",{staticClass:"col-12",staticStyle:{"margin-top":"5px"}},[t._v("Desde: "),i("b",[t._v(t._s(t._f("moment")(1e3*e.timestampStart,"D/MMMM/YY HH:mm:ss")))])]),i("div",{staticClass:"col-12",staticStyle:{"margin-top":"5px"}},[t._v("Hasta: "),i("b",[t._v(t._s(t._f("moment")(1e3*e.timestampEnd,"D/MMMM/YY HH:mm:ss")))])]),e.address?i("div",{staticClass:"col-12 text-justify",staticStyle:{"margin-top":"5px"}},[t._v("Direccion: "+t._s(e.address))]):t._e(),t.animationRoute.showPlayBtn?i("hr",{staticStyle:{width:"100%",margin:"5px"}}):t._e()])])})),0):t._e()]),t.error?i("div",{staticClass:"row"},[i("div",{staticClass:"col-12",staticStyle:{padding:"20px 10px"}},[t._v("El dispositivo no contiene reportes")])]):t._e(),i("div",{staticClass:"row"},[t._m(2),i("div",{staticClass:"col-6 text-left"},[i("button",{staticClass:"btn btn-secondary btn-sm",on:{click:function(e){return t.close()}}},[t._v("CERRAR")])]),!t.error&&t.showForm?i("div",{staticClass:"col-6 text-right"},[i("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(e){return t.getRoute()}}},[t._v("GENERAR")])]):t._e(),t.showForm||t.error||!t.showReports?t._e():i("div",{staticClass:"col-6 text-right"},[i("json-csv",{attrs:{data:t.reports,fields:t.csv.fields,labels:t.csv.labels,name:t.csv.filename}},[i("span",{staticClass:"cssToolTip"},[i("i",{staticClass:"universalicon-file-csv cursor icon-lg"}),i("span",{staticStyle:{left:"-120px !important",top:"-10px"}},[t._v("Exportar csv")])])])],1)])],1)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"col-4 text-left"},[i("h5",[t._v("Recorrido")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"col-12"},[i("hr",{staticStyle:{margin:"0.5rem"}})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"col-12"},[i("hr",{staticStyle:{margin:"0.5rem"}})])}],o=(i("7514"),i("ac6a"),i("96cf"),i("3b8d")),n=(i("7f7f"),i("08e6")),r=i("2347"),l=i.n(r),m=i("d3e3"),c={name:"InfowindowsInfoDispositivo",mixins:[n["a"]],components:{loaderSmall:function(){return i.e("chunk-5fddced4").then(i.bind(null,"33d4"))},JsonCsv:l.a},inject:["getMap","getDraggableProperties","loadDynamicComponent","showMenuFloat","onDevicesSelected"],props:{deviceID:{required:!0},buscador:{required:!0}},data:function(){return{map:null,showForm:!0,fromTimestamp:null,tillTimestamp:null,day:null,device:{alias:"",id:"",imei:"",marker:""},reports:[],positionsScroll:[],firstReport:null,lastReport:null,reportsReady:!1,mapReady:!1,showReports:!1,setSpeedAnimationRouteValue:0,scrollSpeed:1e3,animationRoute:{duration:3e3,timestamp:null,showPlayBtn:!0,showStopBtn:!1,showSpeedBtn:!1,speedBtnText:"x1",speedAnimationRouteBtnClass:"universalicon-forward-x1"},error:!1,loader:{show:!1},markerParking:"marker_tempParkig",polylines:[],markers:[],csv:{fields:["eventString","timestampStartString","timestampEndString","addressStart","addressEnd","speed"],labels:{eventString:"ESTADO",timestampStartString:"HORA INICIAL",timestampEndString:"HORA FINAL",addressStart:"DIRECCION INICIAL",addressEnd:"DIRECCION FINAL",speed:"VELOCIDAD (km/hr)"},filename:"report.csv"}}},mounted:function(){this.map=this.getMap(),this.map.closeAllMarkerInfoWindow(),this.map.showAllMarkers(!1),this.map.$on("onMarkerAnimationPositionChanged",this.onMarkerAnimationPositionChanged),this.$store.commit("mapModule/MAP_CLUSTER",!1),this.showMenuFloat(!1,!0);var t=this.deviceID;this.device.alias=this.$store.state.devices.devices[t].alias,this.device.id=this.$store.state.devices.devices[t].id,this.device.imei=this.$store.state.devices.devices[t].imei,this.device.marker=this.$store.state.devices.devices[t].marker.name,this.fromTimestamp=this.$moment(new Date).startOf("day"),this.tillTimestamp=this.$moment(new Date).endOf("day"),$("#date-report").bootstrapMaterialDatePicker({lang:"es",currentDate:this.fromTimestamp,maxDate:this.$moment(this.fromTimestamp).endOf("day"),year:!1,date:!0,time:!0,shortTime:!0,format:"LLL a"}).on("change",this.onDateChanged),$("#date-end-report").bootstrapMaterialDatePicker({lang:"es",currentDate:this.tillTimestamp,minDate:this.$moment(this.fromTimestamp).startOf("day"),maxDate:this.$moment(this.tillTimestamp).endOf("day"),year:!1,date:!0,time:!0,shortTime:!0,format:"LLL a"}).on("change",this.onDateEndChanged)},beforeDestroy:function(){this.showMenuFloat(!0,!0),this.stopAnimationRoute(),this.clearMarkers(),this.clearPolylines(),this.map.showAllMarkers(!0),this.map.setBoundsAllMarkers(),this.$store.commit("mapModule/MAP_CLUSTER",!0),this.map.$off("onMarkerAnimationPositionChanged")},methods:{lockDraggable:function(t){this.$emit("lockDraggable",t)},onDateChanged:function(t,e){this.fromTimestamp=this.$moment(e),this.tillTimestamp=this.$moment(e).add(24,"hour");var i=this.$moment(e).add(24,"hours"),s=this.$moment(e).startOf("day");console.debug(i,s),console.debug("onDateChanged",this.fromTimestamp.format("LLL a"),i.format("LLL a")),$("#date-end-report").bootstrapMaterialDatePicker("setMinDate",s),$("#date-end-report").bootstrapMaterialDatePicker("setMaxDate",i),$("#date-end-report").bootstrapMaterialDatePicker().currentDate=this.tillTimestamp},getRoute:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,console.debug("Get RouteReporte from ",this.fromTimestamp.format("LLL a")," to ",this.tillTimestamp.format("LLL a")),this.loader.show=!0,e={deviceID:this.device.id,fromTimestamp:this.fromTimestamp.unix(),tillTimestamp:this.tillTimestamp.unix(),order:"ASC",limit:0},t.next=6,this.getRequest("reports/routes/basic",e);case 6:if(i=t.sent,this.reports=i.data.reports,!(this.reports.length>0)){t.next=12;break}this.reportsReady=!0,t.next=13;break;case 12:throw new Error("No reports were found");case 13:t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),console.error(t.t0),this.error=!0;case 19:return t.prev=19,this.showForm=!1,this.loader.show=!1,t.finish(19);case 23:case"end":return t.stop()}}),t,this,[[0,15,19,23]])})));function e(){return t.apply(this,arguments)}return e}(),close:function(){console.debug("STRING_BUSCADOR",this.buscador),m["a"].$emit("EventGetbuscador",this.buscador);var t=function(){return i.e("chunk-2d22dcf7").then(i.bind(null,"f8a0"))};this.loadDynamicComponent("DevicePanel",t,this.buscador)},drawLines:function(){var t=this;try{this.clearPolylines();try{this.firstReport=this.reports[0].reports[0];var e=this.reports.length-1;this.lastReport=this.reports[e].reports[this.reports[e].reports.length-1],this.map.addMarker("deviceRouteStart",this.firstReport.lat,this.firstReport.lng,"FLAG_START"),this.map.addMarker("deviceRouteEnd",this.lastReport.lat,this.lastReport.lng,"FLAG_STOP"),this.markers.push("deviceRouteStart"),this.markers.push("deviceRouteEnd")}catch(a){console.error(a)}var i,s=0;this.reports.forEach((function(e){if(e.id=""+s,e.visible=!0,e.speed=Math.round(e.speed),e.address=e.reports[0].address,e.addressStart=e.reports[0].address,e.addressEnd="",e.timestampStartString=t.$moment.unix(e.reports[0].timestamp).format("DD/MM/YY HH:mm:ss"),e.timestampEndString=t.$moment.unix(e.reports[e.reports.length-1].timestamp).format("DD/MM/YY HH:mm:ss"),s++,"PARKING"==e.event){var a=e.reports[0];a.lat=parseFloat(a.lat),a.lng=parseFloat(a.lng),i={lat:a.lat,lng:a.lng}}else if("MOVEMENT"==e.event){var o=[];o.push(i),e.addressEnd=e.reports[e.reports.length-1].address,e.reports.forEach((function(t){t.lat=parseFloat(t.lat),t.lng=parseFloat(t.lng),o.push({lat:t.lat,lng:t.lng})}));var n="#01579B";t.polylines.push("p"+e.id),t.map.addPolyline(o,"p"+e.id,n,!1,100,!1,.5,12)}})),this.boundsRoute(),this.showReports=!0}catch(a){console.error(a),this.error=!0}},getRandomColor:function(){var t=Math.floor(3*Math.random());switch(t){case 1:t="#01579B";break;case 2:t="#E65100";break;case 3:t="#263238";break;default:t="#1B5E20";break}return t},onViewRoute:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;switch(console.debug("onViewRoute",t,e,i,s),this.map.deleteMarker(this.markerParking),e){case"PARKING":console.debug("maker",t),this.map.addMarker(this.markerParking,i,s,"PARKING"),this.map.centerMap(i,s,17);break;case"MOVEMENT":var a=this.map.getPolylineBounds("p"+t);this.map.centerMapToBounds(a);break}},boundsRoute:function(){if(this.polylines.length>0)this.map.setBoundsAllPolylines();else{var t=this.map.getMarkersBounds(["deviceRouteStart","deviceRouteEnd"]);this.map.centerMapToBounds(t)}},clearPolylines:function(){var t=this;this.polylines.forEach((function(e){try{t.map.deletePolyline(e)}catch(i){console.error(i)}}))},clearMarkers:function(){var t=this;this.markers.forEach((function(e){try{t.map.deleteMarker(e)}catch(i){console.error(i)}})),this.map.deleteMarker(this.markerParking),this.map.deleteMarker("deviceRoute"+this.device.imei),this.markers=[]},playAnimationRoute:function(){console.debug("START animation route"),this.map.deleteMarker(this.markerParking);var t=this.reports[0],e=this.device.marker;"PARKING"==t.event&&(e="PARKING"),this.map.centerMap(this.firstReport.lat,this.firstReport.lng,17),this.map.addMarker("deviceRoute"+this.device.imei,this.firstReport.lat,this.firstReport.lng,e),this.map.moveMarker("deviceRoute"+this.device.imei,this.firstReport.lat,this.firstReport.lng,!1),this.nextSpeedAnimationRoute(),this.AnimateRoute()},stopAnimationRoute:function(){console.debug("STOP animation route"),this.animationRoute.enabled=!1,this.setSpeedAnimationRouteValue=0},nextSpeedAnimationRoute:function(){var t=17;switch(this.setSpeedAnimationRouteValue){case 5e3:this.setSpeedAnimationRouteValue=3e3,this.animationRoute.duration=3e3,this.scrollSpeed=3e3,this.animationRoute.speedBtnText="x5",this.animationRoute.speedAnimationRouteBtnClass="universalicon-forward-x3",t=13;break;case 3e3:this.setSpeedAnimationRouteValue=500,this.animationRoute.duration=500,this.scrollSpeed=500,this.animationRoute.speedAnimationRouteBtnClass="universalicon-forward-x5",t=9;break;case 500:default:this.setSpeedAnimationRouteValue=5e3,this.animationRoute.duration=5e3,this.scrollSpeed=5e3,this.animationRoute.speedBtnText="x3",this.animationRoute.speedAnimationRouteBtnClass="universalicon-forward-x1",t=17;break}this.updateClassSpeedAnimationBtn(),this.map.setZoom(t),console.debug("SET animation speed",t,this.setSpeedAnimationRouteValue)},updateClassSpeedAnimationBtn:function(){$("#speedAnimationRouteBtn").removeClass("universalicon-forward-x1"),$("#speedAnimationRouteBtn").removeClass("universalicon-forward-x3"),$("#speedAnimationRouteBtn").removeClass("universalicon-forward-x5"),console.debug("updateClassSpeedAnimation",this.animationRoute.speedAnimationRouteBtnClass),$("#speedAnimationRouteBtn").addClass(this.animationRoute.speedAnimationRouteBtnClass)},timer:function(t){return new Promise((function(e){return setTimeout(e,t)}))},AnimateRoute:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,i,s,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.animationRoute.enabled=!0,console.debug("animationDuration",this.animationRoute.duration),this.viewElement(0),this.setPositionsItemRoute(),e=0;case 5:if(!(e<this.reports.length)){t.next=45;break}if(!this.animationRoute.enabled){t.next=41;break}if(console.debug("DIPAY:ANIMATE",e),i=this.reports[e],0!=e&&($("#item"+(e-1)).hide(),console.debug("item",e-1)),$("#item"+e).show(),"PARKING"!=i.event){t.next=23;break}return s=i.reports[0],this.animationRoute.timestamp=s.timestamp,this.map.moveMarker("deviceRoute"+this.device.imei,s.lat,s.lng,!0,this.animationRoute.duration),t.next=17,this.timer(this.animationRoute.duration);case 17:if(this.map.setMarkerIcon("deviceRoute"+this.device.imei,"PARKING"),!(e+1<this.reports.length)){t.next=21;break}return t.next=21,this.timer(this.animationRoute.duration);case 21:t.next=39;break;case 23:if("MOVEMENT"!=i.event){t.next=39;break}this.map.setMarkerIcon("deviceRoute"+this.device.imei,this.device.marker),a=0;case 26:if(!(a<i.reports.length)){t.next=39;break}if(s=i.reports[a],!this.animationRoute.enabled){t.next=35;break}return this.animationRoute.timestamp=s.timestamp,this.map.moveMarker("deviceRoute"+this.device.imei,s.lat,s.lng,!0,this.animationRoute.duration),t.next=33,this.timer(this.animationRoute.duration);case 33:t.next=36;break;case 35:return t.abrupt("break",39);case 36:a++,t.next=26;break;case 39:t.next=42;break;case 41:return t.abrupt("break",45);case 42:e++,t.next=5;break;case 45:this.viewElement(1),this.map.moveMarker("deviceRoute"+this.device.imei,this.firstReport.lat,this.firstReport.lng,!1),this.map.deleteMarker("deviceRoute"+this.device.imei),this.boundsRoute(),this.setAnimationRouteButtons(!0,!1,!1,!1);case 50:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),setPositionsItemRoute:function(){this.positionsScroll=[];for(var t=0;t<this.reports.length;t++){var e=this.reports[t],i=$("#item".concat(e.id)).position();this.positionsScroll.push({id:parseInt(t+1),positions:i.top})}},scrollTo:function(t){if(0==t)$("#divContainerDos").animate({scrollTop:0},2e3);else{var e=this.positionsScroll.find((function(e){return e.id==t}));$("#"+t).prop("checked",!0);var i=e.positions-45;$("#divContainerDos").animate({scrollTop:i},this.scrollSpeed)}},viewElement:function(t){console.debug("DIspaly_CONDICIONS",t);for(var e=0;e<this.reports.length;e++)0==t&&$("#item"+e).hide(),1==t&&$("#item"+e).show()},onMarkerAnimationPositionChanged:function(t,e){t=="deviceRoute"+this.device.imei&&this.map.centerMap(e.lat,e.lng)},setAnimationRouteButtons:function(t,e,i){this.animationRoute.showPlayBtn=t,this.animationRoute.showStopBtn=e,this.animationRoute.showSpeedBtn=i}},watch:{reportsReady:function(t){this.drawLines();var e=this.fromTimestamp.format("LL");this.csv.filename="Recorrido - ".concat(this.device.alias," - ").concat(e,".csv")}}},d=c,p=(i("f906"),i("2877")),u=Object(p["a"])(d,s,a,!1,null,null,null);e["default"]=u.exports},"86a6":function(t,e,i){},f906:function(t,e,i){"use strict";var s=i("86a6"),a=i.n(s);a.a}}]);
//# sourceMappingURL=chunk-61512086.41f24967.js.map